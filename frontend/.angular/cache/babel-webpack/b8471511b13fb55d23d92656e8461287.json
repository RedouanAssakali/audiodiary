{"ast":null,"code":"import { cloneDeep } from '../internal/utils/cloneDeep.js';\nimport { isObject } from \"./utils/isObject.js\";\n/**\n * Class for defining account configuration options.\n * Depends on 'utils'\n */\n\n/**\n * Assign values from sources if they are not defined in the destination.\n * Once a value is set it does not change\n * @function Util.defaults\n * @param {Object} destination - the object to assign defaults to\n * @param sources\n * @param {...Object} source - the source object(s) to assign defaults from\n * @return {Object} destination after it was modified\n */\n\nconst useDefaultValues = (destination, ...sources) => {\n  return sources.reduce(function (dest, source) {\n    let key, value;\n\n    for (key in source) {\n      // @ts-ignore\n      value = source[key]; // @ts-ignore\n\n      if (dest[key] === void 0) {\n        // @ts-ignore\n        dest[key] = value;\n      }\n    }\n\n    return dest;\n  }, destination);\n};\n/**\n * Class for defining account configuration options.\n * @constructor Configuration\n * @param {Object} options - The account configuration parameters to set.\n * @see <a href=\"https://cloudinary.com/documentation/solution_overview#configuration_parameters\"\n *  target=\"_new\">Available configuration options</a>\n */\n\n\nclass Configuration {\n  constructor(options) {\n    this.configuration = options == null ? {} : cloneDeep(options);\n    useDefaultValues(this.configuration, DEFAULT_CONFIGURATION_PARAMS);\n  }\n  /**\n   * Initializes the configuration. This method is a convenience method that invokes both\n   *  {@link Configuration#fromEnvironment|fromEnvironment()} (Node.js environment only)\n   *  and {@link Configuration#fromDocument|fromDocument()}.\n   *  It first tries to retrieve the configuration from the environment variable.\n   *  If not available, it tries from the document meta tags.\n   * @function Configuration#init\n   * @return {Configuration} returns `this` for chaining\n   * @see fromDocument\n   * @see fromEnvironment\n   */\n\n\n  init() {\n    this.fromEnvironment();\n    this.fromDocument();\n    return this;\n  }\n  /**\n   * Set a new configuration item\n   * @function Configuration#set\n   * @param {string} name - the name of the item to set\n   * @param {*} value - the value to be set\n   * @return {Configuration}\n   *\n   */\n\n\n  set(name, value) {\n    // @ts-ignore\n    this.configuration[name] = value;\n    return this;\n  }\n  /**\n   * Get the value of a configuration item\n   * @function Configuration#get\n   * @param {string} name - the name of the item to set\n   * @return {*} the configuration item\n   */\n\n\n  get(name) {\n    return this.configuration[name];\n  }\n\n  merge(config) {\n    Object.assign(this.configuration, cloneDeep(config));\n    return this;\n  }\n  /**\n   * Initialize Cloudinary from HTML meta tags.\n   * @function Configuration#fromDocument\n   * @return {Configuration}\n   * @example <meta name=\"cloudinary_cloud_name\" content=\"mycloud\">\n   *\n   */\n\n\n  fromDocument() {\n    var el, i, len, meta_elements;\n    meta_elements = typeof document !== \"undefined\" && document !== null ? document.querySelectorAll('meta[name^=\"cloudinary_\"]') : void 0;\n\n    if (meta_elements) {\n      for (i = 0, len = meta_elements.length; i < len; i++) {\n        el = meta_elements[i];\n        this.configuration[el.getAttribute('name').replace('cloudinary_', '')] = el.getAttribute('content');\n      }\n    }\n\n    return this;\n  }\n  /**\n   * Initialize Cloudinary from the `CLOUDINARY_URL` environment variable.\n   *\n   * This function will only run under Node.js environment.\n   * @function Configuration#fromEnvironment\n   * @requires Node.js\n   */\n\n\n  fromEnvironment() {\n    var cloudinary_url, query, uri, uriRegex;\n\n    if (typeof process !== \"undefined\" && process !== null && process.env && process.env.CLOUDINARY_URL) {\n      cloudinary_url = process.env.CLOUDINARY_URL;\n      uriRegex = /cloudinary:\\/\\/(?:(\\w+)(?:\\:([\\w-]+))?@)?([\\w\\.-]+)(?:\\/([^?]*))?(?:\\?(.+))?/;\n      uri = uriRegex.exec(cloudinary_url);\n\n      if (uri) {\n        if (uri[3] != null) {\n          this.configuration['cloud_name'] = uri[3];\n        }\n\n        if (uri[1] != null) {\n          this.configuration['api_key'] = uri[1];\n        }\n\n        if (uri[2] != null) {\n          this.configuration['api_secret'] = uri[2];\n        }\n\n        if (uri[4] != null) {\n          this.configuration['private_cdn'] = uri[4] != null;\n        }\n\n        if (uri[4] != null) {\n          this.configuration['secure_distribution'] = uri[4];\n        }\n\n        query = uri[5];\n\n        if (query != null) {\n          query.split('&').forEach(value => {\n            let [k, v] = value.split('=');\n\n            if (v == null) {\n              // @ts-ignore\n              v = true;\n            }\n\n            this.configuration[k] = v;\n          });\n        }\n      }\n    }\n\n    return this;\n  }\n  /**\n   * Create or modify the Cloudinary client configuration\n   *\n   * Warning: `config()` returns the actual internal configuration object. modifying it will change the configuration.\n   *\n   * This is a backward compatibility method. For new code, use get(), merge() etc.\n   * @function Configuration#config\n   * @param {hash|string|boolean} new_config\n   * @param {string} new_value\n   * @returns {*} configuration, or value\n   *\n   * @see {@link fromEnvironment} for initialization using environment variables\n   * @see {@link fromDocument} for initialization using HTML meta tags\n   */\n\n\n  config(new_config, new_value) {\n    switch (false) {\n      case new_value === void 0:\n        this.set(new_config, new_value);\n        return this.configuration;\n\n      case typeof new_config != 'string':\n        return this.get(new_config);\n\n      case !isObject(new_config):\n        this.merge(new_config);\n        return this.configuration;\n\n      default:\n        // Backward compatibility - return the internal object\n        return this.configuration;\n    }\n  }\n  /**\n   * Returns a copy of the configuration parameters\n   * @function Configuration#toOptions\n   * @returns {Object} a key:value collection of the configuration parameters\n   */\n\n\n  toOptions() {\n    return cloneDeep(this.configuration);\n  }\n\n}\n\nconst DEFAULT_CONFIGURATION_PARAMS = {\n  responsive_class: 'cld-responsive',\n  responsive_use_breakpoints: true,\n  round_dpr: true,\n  secure: (typeof window !== \"undefined\" && window !== null ? window.location ? window.location.protocol : void 0 : void 0) === 'https:'\n};\nexport const CONFIG_PARAMS = [\"api_key\", \"api_secret\", \"callback\", \"cdn_subdomain\", \"cloud_name\", \"cname\", \"private_cdn\", \"protocol\", \"resource_type\", \"responsive\", \"responsive_class\", \"responsive_use_breakpoints\", \"responsive_width\", \"round_dpr\", \"secure\", \"secure_cdn_subdomain\", \"secure_distribution\", \"shorten\", \"type\", \"upload_preset\", \"url_suffix\", \"use_root_path\", \"version\", \"externalLibraries\", \"max_timeout_ms\"];\nexport default Configuration;","map":null,"metadata":{},"sourceType":"module"}